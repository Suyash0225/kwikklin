<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Services - Kwik Klin Smart Services</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css?v=1.2">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container nav">
            <a href="index.html" class="logo">
                <img src="images/logo.png" alt="Kwik Klin">
                <span style="margin-left:8px; font-weight:700; color:#334155;">Kwik Klin</span>
            </a>
            <div class="mobile-menu-btn" onclick="toggleMenu()"><i class="bi bi-list"></i></div>
            <nav class="nav-links" id="nav-links">
                <a href="index.html" class="nav-link">Home</a>
                <a href="services.html" class="nav-link active">Services</a>
                <a href="story.html" class="nav-link">Our Story</a>
                <a href="blogs.html" class="nav-link">Blogs</a>
                <a href="cart.html" class="nav-link cart-icon">
                    <i class="bi bi-cart3"></i>
                    <span id="cart-count">0</span>
                </a>
                <a href="https://wa.me/9696856069" class="btn btn-primary" target="_blank">
                    <i class="bi bi-whatsapp"></i> 9696856069
                </a>
            </nav>
        </div>
    </header>

    <!-- Page Title -->
    <section class="page-header-section">
        <div class="container">
            <h1>Our Services</h1>
            <p>Detailed care for every fabric type.</p>
        </div>
    </section>

    <!-- Filters -->
    <section class="sticky-filter-section">
        <div class="container">
            <div class="filter-inner-grid">

                <!-- Search & Categories -->
                <div class="filter-header-flex">
                    <!-- Search -->
                    <div class="search-container">
                        <i class="bi bi-search"></i>
                        <input type="text" id="search-input" onkeyup="searchServices()" placeholder="Find a service...">
                    </div>

                    <!-- Category Filters -->
                    <div class="filter-group" id="category-filters">
                        <!-- Dynamic categories -->
                    </div>
                </div>

                <!-- Bottom Row: Sub-Category (More subtle) -->
                <div class="filter-sub-row">
                    <span class="filter-label">Filter by:</span>
                    <div class="filter-group" id="subcategory-filters">
                        <button class="filter-chip active" onclick="filterSubServices('All')">All</button>
                        <!-- Dynamic sub-categories -->
                    </div>
                </div>

            </div>
        </div>

    </section>

    <!-- Services Grid -->
    <section class="section">
        <div class="container">
            <div id="services-container" class="services-grid">
                <!-- Javascript will load services here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <!-- Same Footer Include -->
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h3>Kwik Klin</h3>
                    <p>Smart Laundry Services in Varanasi.</p>
                </div>
                <div class="footer-col">
                    <h3>Legal</h3>
                    <ul class="footer-links">
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">&copy; 2025 Kwik Klin.</div>
        </div>
    </footer>

    <script src="data.js"></script>
    <script>
        function toggleMenu() {
            const nav = document.getElementById('nav-links');
            const icon = document.querySelector('.mobile-menu-btn i');
            nav.classList.toggle('active');
            document.body.classList.toggle('menu-open');

            if (document.body.classList.contains('menu-open')) {
                icon.classList.replace('bi-list', 'bi-x-lg');
            } else {
                icon.classList.replace('bi-x-lg', 'bi-list');
            }
        }

        let allServices = [];
        let currentCategory = 'All';
        let currentSubCategory = 'All';

        document.addEventListener('DOMContentLoaded', () => {
            DataManager.updateCartCount();

            // Load and render
            allServices = DataManager.getServices();
            setupFilters();
            renderServices(allServices);
        });


        function setupFilters() {
            // 1. Icon Categories
            const categories = ['All', ...new Set(allServices.map(s => s.category))];
            const catContainer = document.getElementById('category-filters');

            catContainer.innerHTML = '';
            catContainer.className = 'category-slider'; // Change class for new styles

            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = `filter-pill ${cat === 'All' ? 'active' : ''}`;
                btn.onclick = () => filterServices(cat);

                // Add Icon
                const iconClass = DataManager.getCategoryIcon(cat);
                const iconHtml = `<i class="bi ${iconClass}" style="margin-right:6px;"></i>`;

                btn.innerHTML = `${iconHtml}${cat}`;
                catContainer.appendChild(btn);
            });

            // 2. Sub-Categories
            const subCategories = ['All', ...new Set(allServices.map(s => s.subCategory || 'Other'))];
            const subContainer = document.getElementById('subcategory-filters');
            subContainer.innerHTML = '';

            const validSub = subCategories.filter(s => s && s !== 'Other');
            if (validSub.length <= 1) {
                subContainer.parentElement.style.display = 'none';
            } else {
                subContainer.parentElement.style.display = 'flex';
                subCategories.forEach(sub => {
                    if (!sub) return;
                    const btn = document.createElement('button');
                    btn.className = `filter-chip ${sub === 'All' ? 'active' : ''}`;
                    btn.innerText = sub;
                    btn.onclick = () => filterSubServices(sub);
                    subContainer.appendChild(btn);
                });
            }
        }

        function filterServices(category) {
            currentCategory = category;
            // Update Category UI
            document.querySelectorAll('.filter-pill').forEach(btn => {
                // Find potential text content safely
                const btnText = btn.innerText || btn.textContent;
                if (btnText.trim() === category) btn.classList.add('active');
                else btn.classList.remove('active');
            });
            applyFilters();
        }

        function renderServices(services) {
            const container = document.getElementById('services-container');
            container.innerHTML = '';
            container.className = 'service-list-container';

            if (services.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 2rem; color: #64748b; width:100%;">No services found.</div>';
                return;
            }

            const cart = DataManager.getCart();

            services.forEach(service => {
                const cartItem = cart.find(item => item.id === service.id);
                const card = document.createElement('div');
                card.id = `service-${service.id}`;
                card.className = 'service-list-card';
                card.style.animation = 'fadeIn 0.3s ease-out';

                const iconClass = DataManager.getCategoryIcon(service.category);

                card.innerHTML = `
                    <div class="list-card-img-wrapper" style="display:flex; align-items:center; justify-content:center; background: #e0f2fe; color: #0ea5e9; font-size: 1.8rem;">
                        <i class="bi ${iconClass}"></i>
                    </div>
                    
                    <div class="list-card-info">
                        <h3 class="list-card-title">${service.name}</h3>
                        <div class="list-card-price">â‚¹ ${service.price}</div>
                    </div>

                    <div class="list-card-action" id="action-${service.id}">
                        ${getActionHtml(service.id, cartItem ? cartItem.quantity : 0)}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function getActionHtml(serviceId, quantity) {
            if (quantity > 0) {
                return `
                    <div class="qty-selector">
                        <button onclick="changeQty('${serviceId}', -1)"><i class="bi bi-dash"></i></button>
                        <span class="qty-val">${quantity}</span>
                        <button onclick="changeQty('${serviceId}', 1)"><i class="bi bi-plus"></i></button>
                    </div>
                `;
            } else {
                return `
                    <button class="add-btn-orange" onclick="addToCart(this, '${serviceId}')">
                        <i class="bi bi-plus-lg"></i> ADD
                    </button>
                `;
            }
        }

        function filterSubServices(subCategory) {
            currentSubCategory = subCategory;

            // Update Sub-Category UI
            document.querySelectorAll('#subcategory-filters .filter-chip').forEach(btn => {
                btn.classList.toggle('active', btn.innerText === subCategory);
            });

            applyFilters();
        }

        function searchServices() {
            applyFilters();
        }

        function applyFilters() {
            const query = document.getElementById('search-input').value.toLowerCase();

            const filtered = allServices.filter(s => {
                // 1. Matches Main Category
                const matchesCat = currentCategory === 'All' || s.category === currentCategory;

                // 2. Matches Sub Category
                const sSub = s.subCategory || 'Other';
                const matchesSub = currentSubCategory === 'All' || sSub === currentSubCategory;

                // 3. Matches Search
                const matchesSearch = s.name.toLowerCase().includes(query) ||
                    s.category.toLowerCase().includes(query) ||
                    (s.subCategory && s.subCategory.toLowerCase().includes(query));

                return matchesCat && matchesSub && matchesSearch;
            });

            renderServices(filtered);
        }

        function addToCart(btn, id) {
            DataManager.addToCart(id, 1);
            updateActionArea(id);
        }

        function changeQty(id, change) {
            DataManager.updateQuantity(id, change);
            updateActionArea(id);
        }

        function updateActionArea(id) {
            const container = document.getElementById(`action-${id}`);
            if (!container) return;

            const cart = DataManager.getCart();
            const item = cart.find(i => i.id === id);
            const quantity = item ? item.quantity : 0;

            container.innerHTML = getActionHtml(id, quantity);
        }
    </script>
</body>

</html>